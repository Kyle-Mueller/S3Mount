<Window x:Class="S3Mount.Views.MountConfigurationDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Configure S3 Mount" Height="750" Width="650"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        Background="{StaticResource PrimaryBackgroundBrush}">
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    </Window.Resources>
    
    <Grid Margin="0">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <Border Grid.Row="0" 
                Background="{StaticResource SecondaryBackgroundBrush}" 
                BorderBrush="{StaticResource BorderBrush}" 
                BorderThickness="0,0,0,1"
                Padding="32,24">
            <StackPanel>
                <TextBlock FontSize="24" FontWeight="SemiBold">
                    <Run Text="Configure" Foreground="{StaticResource PrimaryTextBrush}"/>
                    <Run Text="S3 Mount" Foreground="{StaticResource AccentOrangeBrush}"/>
                </TextBlock>
                <TextBlock Text="Set up your S3 bucket as a Windows drive" 
                          FontSize="13" 
                          Foreground="{StaticResource SecondaryTextBrush}"
                          Margin="0,6,0,0"/>
            </StackPanel>
        </Border>
        
        <!-- Form -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Margin="32,24">
            <StackPanel>
                <!-- Provider Selection -->
                <TextBlock Text="PROVIDER" 
                          FontWeight="SemiBold" 
                          FontSize="12"
                          Foreground="{StaticResource SecondaryTextBrush}"
                          Margin="0,0,0,8"/>
                <ComboBox ItemsSource="{Binding Providers}"
                         SelectedItem="{Binding SelectedProvider}"
                         DisplayMemberPath="Name"
                         Margin="0,0,0,8"/>
                <TextBlock Text="{Binding SelectedProvider.Description}" 
                          FontSize="12" 
                          Foreground="{StaticResource TertiaryTextBrush}" 
                          Margin="0,0,0,20"/>
                
                <!-- Mount Name -->
                <TextBlock Text="MOUNT NAME" 
                          FontWeight="SemiBold" 
                          FontSize="12"
                          Foreground="{StaticResource SecondaryTextBrush}"
                          Margin="0,0,0,8"/>
                <TextBox Text="{Binding MountName, UpdateSourceTrigger=PropertyChanged}"
                        ToolTip="Friendly name for this mount"
                        Margin="0,0,0,20"/>
                
                <!-- Bucket Name -->
                <TextBlock Text="BUCKET NAME" 
                          FontWeight="SemiBold" 
                          FontSize="12"
                          Foreground="{StaticResource SecondaryTextBrush}"
                          Margin="0,0,0,8"/>
                <TextBox Text="{Binding BucketName, UpdateSourceTrigger=PropertyChanged}"
                        ToolTip="Name of the S3 bucket"
                        Margin="0,0,0,20"/>
                
                <!-- Service URL -->
                <TextBlock Text="SERVICE URL" 
                          FontWeight="SemiBold" 
                          FontSize="12"
                          Foreground="{StaticResource SecondaryTextBrush}"
                          Margin="0,0,0,8"/>
                <TextBox Text="{Binding ServiceUrl, UpdateSourceTrigger=PropertyChanged}"
                        ToolTip="S3 service endpoint URL"
                        Margin="0,0,0,20"/>
                
                <Grid Margin="0,0,0,20">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="20"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Region -->
                    <StackPanel Grid.Column="0">
                        <TextBlock Text="REGION" 
                                  FontWeight="SemiBold" 
                                  FontSize="12"
                                  Foreground="{StaticResource SecondaryTextBrush}"
                                  Margin="0,0,0,8"/>
                        <TextBox Text="{Binding Region, UpdateSourceTrigger=PropertyChanged}"
                                ToolTip="AWS region or custom region identifier"/>
                    </StackPanel>
                    
                    <!-- Drive Letter -->
                    <StackPanel Grid.Column="2">
                        <TextBlock Text="DRIVE LETTER" 
                                  FontWeight="SemiBold" 
                                  FontSize="12"
                                  Foreground="{StaticResource SecondaryTextBrush}"
                                  Margin="0,0,0,8"/>
                        <ComboBox ItemsSource="{Binding AvailableDriveLetters}"
                                 SelectedItem="{Binding SelectedDriveLetter}"
                                 ToolTip="Select drive letter or Auto for automatic assignment"/>
                    </StackPanel>
                </Grid>
                
                <!-- Access Credentials -->
                <Border Background="{StaticResource TertiaryBackgroundBrush}"
                        BorderBrush="{StaticResource BorderBrush}"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="20" 
                        Margin="0,8,0,20">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                            <TextBlock Text="🔐" FontSize="16" Margin="0,0,8,0"/>
                            <TextBlock Text="Access Credentials" 
                                      FontWeight="SemiBold" 
                                      FontSize="14"
                                      Foreground="{StaticResource PrimaryTextBrush}"/>
                        </StackPanel>
                        
                        <TextBlock Text="ACCESS KEY" 
                                  FontWeight="SemiBold" 
                                  FontSize="12"
                                  Foreground="{StaticResource SecondaryTextBrush}"
                                  Margin="0,0,0,8"/>
                        <TextBox Text="{Binding AccessKey, UpdateSourceTrigger=PropertyChanged}"
                                Margin="0,0,0,16"/>
                        
                        <TextBlock Text="SECRET KEY" 
                                  FontWeight="SemiBold" 
                                  FontSize="12"
                                  Foreground="{StaticResource SecondaryTextBrush}"
                                  Margin="0,0,0,8"/>
                        <PasswordBox x:Name="SecretKeyBox" 
                                    PasswordChanged="SecretKeyBox_PasswordChanged"
                                    Margin="0,0,0,12"/>
                        
                        <Border Background="{StaticResource SecondaryBackgroundBrush}"
                               BorderBrush="{StaticResource WarningBrush}"
                               BorderThickness="1"
                               CornerRadius="6"
                               Padding="12,10">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="⚠️" Margin="0,0,8,0" FontSize="14"/>
                                <TextBlock Text="Credentials are encrypted using Windows DPAPI and stored securely" 
                                          FontSize="11" 
                                          Foreground="{StaticResource SecondaryTextBrush}"
                                          TextWrapping="Wrap"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Border>
                
                <!-- Advanced Options -->
                <Expander Header="⚙️ Advanced Options" 
                         Margin="0,0,0,20"
                         Foreground="{StaticResource PrimaryTextBrush}"
                         Background="{StaticResource TertiaryBackgroundBrush}"
                         BorderBrush="{StaticResource BorderBrush}"
                         BorderThickness="1"
                         Padding="0">
                    <Border Background="{StaticResource SecondaryBackgroundBrush}"
                           BorderBrush="{StaticResource BorderBrush}"
                           BorderThickness="0,1,0,0"
                           Padding="20,16">
                        <StackPanel>
                            <CheckBox Content="Force Path Style (required for MinIO and some providers)" 
                                     IsChecked="{Binding ForcePathStyle}"
                                     Foreground="{StaticResource PrimaryTextBrush}"
                                     Margin="0,0,0,12"/>
                            
                            <CheckBox Content="Auto-mount on application startup" 
                                     IsChecked="{Binding AutoMount}"
                                     Foreground="{StaticResource PrimaryTextBrush}"
                                     Margin="0,0,0,16"/>
                            
                            <TextBlock Text="CUSTOM DRIVE ICON (PNG/ICO)" 
                                      FontWeight="SemiBold" 
                                      FontSize="12"
                                      Foreground="{StaticResource SecondaryTextBrush}"
                                      Margin="0,0,0,8"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBox Grid.Column="0" 
                                        Text="{Binding IconPath, UpdateSourceTrigger=PropertyChanged}" 
                                        IsReadOnly="True"/>
                                <Button Grid.Column="1" 
                                       Content="Browse" 
                                       Command="{Binding BrowseIconCommand}"
                                       Style="{StaticResource ModernButton}"
                                       Margin="8,0,0,0"
                                       Padding="16,10"/>
                            </Grid>
                        </StackPanel>
                    </Border>
                </Expander>
                
                <!-- Test Connection -->
                <Border Background="{StaticResource TertiaryBackgroundBrush}"
                       BorderBrush="{StaticResource AccentBlueBrush}"
                       BorderThickness="1"
                       CornerRadius="8"
                       Padding="20">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        
                        <Button Grid.Row="0" 
                               Command="{Binding TestConnectionCommand}"
                               IsEnabled="{Binding IsTestingConnection, Converter={StaticResource InverseBoolConverter}}"
                               Background="{StaticResource AccentBlueBrush}"
                               Foreground="White"
                               Style="{StaticResource ModernButton}"
                               Padding="16,12" 
                               HorizontalAlignment="Stretch">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <TextBlock Text="🔍" FontSize="16" Margin="0,0,8,0"/>
                                <TextBlock Text="Test Connection" FontSize="14" FontWeight="SemiBold"/>
                            </StackPanel>
                        </Button>
                        
                        <Border Grid.Row="1" 
                               Background="{StaticResource SecondaryBackgroundBrush}"
                               BorderBrush="{StaticResource BorderBrush}"
                               BorderThickness="1"
                               CornerRadius="6"
                               Padding="12,10"
                               Margin="0,12,0,0"
                               Visibility="{Binding TestResult, Converter={StaticResource StringNotEmptyToVisConverter}}">
                            <TextBlock Text="{Binding TestResult}" 
                                      TextWrapping="Wrap"
                                      FontWeight="SemiBold"
                                      Foreground="{StaticResource PrimaryTextBrush}"/>
                        </Border>
                    </Grid>
                </Border>
            </StackPanel>
        </ScrollViewer>
        
        <!-- Footer Buttons -->
        <Border Grid.Row="2"
                Background="{StaticResource SecondaryBackgroundBrush}"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="0,1,0,0"
                Padding="32,20">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock Grid.Column="0" 
                          Text="* All fields are required" 
                          FontSize="12" 
                          Foreground="{StaticResource TertiaryTextBrush}" 
                          VerticalAlignment="Center"/>
                
                <Button Grid.Column="1" 
                       Command="{Binding SaveCommand}"
                       Click="SaveButton_Click"
                       Style="{StaticResource PrimaryButton}"
                       Padding="24,12" 
                       Margin="0,0,12,0"
                       MinWidth="120">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="💾" FontSize="14" Margin="0,0,8,0"/>
                        <TextBlock Text="Save" FontSize="14" FontWeight="SemiBold"/>
                    </StackPanel>
                </Button>
                
                <Button Grid.Column="2" 
                       Command="{Binding CancelCommand}"
                       Click="CancelButton_Click"
                       Style="{StaticResource ModernButton}"
                       Padding="24,12"
                       MinWidth="120">
                    <TextBlock Text="Cancel" FontSize="14" FontWeight="Medium"/>
                </Button>
            </Grid>
        </Border>
    </Grid>
</Window>
